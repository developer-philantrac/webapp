<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Onboarding</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://connect-js.stripe.com/v1.0/connect.js"></script>
</head>

<body>
  <div id="container">
    <p id="loading">Loading onboarding form...</p>
    <div id="error" style="color:red;"></div>
  </div>

  <script>
    window.addEventListener("load", () => {
      const urlParams = new URLSearchParams(window.location.search);
      const clientSecret = urlParams.get("client_secret");
      const publishableKey = "pk_test_51QpxmvLuSJ6SZh9bRzI5rRwkxSV0QdQSo3lZdOcmeCuqJcHrKgrm0tGPJx2d9oCcptzcT0MO3YzFFiFdpknLGtjS00YIsOEmNn";

      const container = document.getElementById("container");
      const loading = document.getElementById("loading");
      const error = document.getElementById("error");

      if (!clientSecret) {
        loading.style.display = "none";
        error.textContent = "Missing client_secret in URL.";
        return;
      }

      try {
        const stripeConnect = StripeConnect.init({
          publishableKey,
          fetchClientSecret: () => Promise.resolve(clientSecret)
        });

        const onboarding = stripeConnect.create("account-onboarding");

        onboarding.setOnExit(() => {
          console.log("User exited onboarding.");
        });

        onboarding.setOnStepChange((step) => {
          console.log("Current step:", step);
        });

        if (typeof onboarding.mount !== "function") {
          throw new Error("Onboarding component is not mountable.");
        }

        loading.remove();
        onboarding.mount("#container");
      } catch (err) {
        loading.style.display = "none";
        error.textContent = "Failed to load onboarding.";
        console.error("Onboarding error:", err);
      }
    });
  </script>
</body>
</html>
