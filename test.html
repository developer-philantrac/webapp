<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Philantrac ‚Äì Onboarding</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://connect-js.stripe.com/v1.0/connect.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />
  <style>
    :root {
      --primary: #186d40;
      --secondary: #ff8c2e;
      --primary-text: #222222;
      --secondary-text: #888888;
      --primary-bg: #fafafa;
      --secondary-bg: #ffffff;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --primary: #186d40;
        --secondary: #ff8c2e;
        --primary-text: #ffffff;
        --secondary-text: #95a1ac;
        --primary-bg: #1d2428;
        --secondary-bg: #14181b;
      }
    }

    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 30px;
      background-color: var(--primary-bg);
      color: var(--secondary-text);
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    #container {
      max-width: 600px;
      margin: auto;
      padding: 20px;
      background: var(--secondary-bg);
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    #loading {
      text-align: center;
      font-size: 18px;
      padding: 40px;
    }

    #error {
      color: red;
      text-align: center;
      margin-top: 20px;
    }
  </style>
</head>

<body>
  <div id="container">
    <div id="loading">Loading onboarding form...</div>
    <div id="error"></div>
  </div>

  <script>
    window.addEventListener("load", () => {
      const urlParams = new URLSearchParams(window.location.search);
      const clientSecret = urlParams.get("client_secret"); // ‚úÖ fixed param name
      const publishableKey = "pk_test_51QpxmvLuSJ6SZh9bRzI5rRwkxSV0QdQSo3lZdOcmeCuqJcHrKgrm0tGPJx2d9oCcptzcT0MO3YzFFiFdpknLGtjS00YIsOEmNn";

      const showError = (message) => {
        document.getElementById("error").innerText = message;
        console.error("üõë", message);
      };

      if (!clientSecret) {
        showError("Missing client_secret in URL.");
        return;
      }

      const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;

      try {
        const stripeConnectInstance = StripeConnect.init({
          publishableKey,
          fetchClientSecret: () => Promise.resolve(clientSecret),
          appearance: {
            variables: {
              colorPrimary: "#186d40",
              colorText: isDarkMode ? "#95a1ac" : "#888888",
              borderRadius: "8px",
              fontFamily: "Roboto, sans-serif",
            },
            rules: {
              ".Tab, .Button, .Link": {
                color: "#186d40",
              },
              ".Button--primary": {
                backgroundColor: "#186d40",
                color: "#ffffff",
              },
              ".Input": {
                borderColor: "#186d40",
                color: isDarkMode ? "#95a1ac" : "#888888",
              }
            }
          }
        });

        const onboarding = stripeConnectInstance.create("account-onboarding");

        if (!onboarding || typeof onboarding.mount !== "function") {
          showError("Onboarding component is invalid or not mountable.");
          return;
        }

        onboarding.setOnExit(() => {
          console.log("User exited onboarding");
        });

        onboarding.setOnStepChange((stepChange) => {
          console.log("User entered step:", stepChange.step);
        });

        const container = document.getElementById("container");
        container.innerHTML = ""; // Clear loading message
        onboarding.mount("#container"); // ‚úÖ using mount instead of appendChild
        console.log("‚úÖ Onboarding form mounted.");
      } catch (error) {
        showError("Failed to load onboarding form.");
        console.error("‚ùå", error);
      }
    });
  </script>
</body>
</html>
